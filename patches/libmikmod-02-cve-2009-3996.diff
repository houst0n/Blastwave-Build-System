--- libmikmod-3.2.0-beta2/loaders/load_ult.c	Wed Jan 21 02:36:35 2004
+++ libmikmod-3.2.0-beta2-patch/loaders/load_ult.c	Mon Jul 19 14:51:36 2010
@@ -225,6 +225,10 @@
 		for(t=0;t<of.numpat;t++)
 			of.patterns[(t*of.numchn)+u]=tracks++;
 
+	/* fix for CVE-2009-3996 */
+	if (of.numchn>=UF_MAXCHAN)
+		of.numchn=UF_MAXCHAN - 1;
+
 	/* read pan position table for v1.5 and higher */
 	if(mh.id[14]>='3') {
 		for(t=0;t<of.numchn;t++) of.panning[t]=_mm_read_UBYTE(modreader)<<4;
